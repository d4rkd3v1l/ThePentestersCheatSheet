# TCP 389, 636, 3268, 3269: LDAP

> The Lightweight Directory Access Protocol (**LDAP**) is an open, vendor-neutral, industry standard application protocol for accessing and maintaining distributed directory information services over an Internet Protocol (IP) network.  

## Related

[Active Directoy](bear://x-callback-url/open-note?id=5C9EC040-0001-45F1-852C-769DB3092467-524-00001FFA6E2A0DB1)
[TCP 88: Kerberos](bear://x-callback-url/open-note?id=737CB967-22F6-401E-9BEC-5D28FA7350F1-483-00001AB8DF3B4F91)
[Impacket](bear://x-callback-url/open-note?id=8B82F3FA-7934-4517-98E9-ED74DD9C76EB-524-000018D307D11453)

## Enumeration

### ldapsearch

```bash
ldapsearch -x -h <ip> -s base namingcontexts
```

using namingcontexts from previous call
```bash
ldapsearch -x -h <ip> -b 'dc=lightweight,dc=htb'
```

look for `userPassword`s, `description` (sometimes admins put interessting stuff there)

### windapsearch

most stuff requires a valid user account
```bash
windapsearch.py --dc-ip <ip>
```

dump all
```bash
./windapsearch.py --dc-ip <ip> -u <user> -p <pw> -G -U -PU -C --da --admin-objects --user-spns --unconstrained-users --unconstrained-computers --gpos --full
```

### Capture requests (e.g. Wireshark)

Find password in request:
LDAP -> bindRequest -> authentication: simple -> PASSWORD
